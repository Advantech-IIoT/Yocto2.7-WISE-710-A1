From 1d0d6a188b9ae585838895eccd45035662c32ad7 Mon Sep 17 00:00:00 2001
From: Ralph Wang <advantechralph@gmail.com>
Date: Tue, 30 Jun 2020 16:59:02 +0800
Subject: [PATCH] wise710a1

---
 Makefile                                 |  5 +++
 arch/arm/dts/imx6qdl-sabresd-u-boot.dtsi | 16 ++++++++--
 arch/arm/dts/imx6qdl-sabresd.dtsi        | 27 +++++++++++-----
 arch/arm/dts/imx6qdl-u-boot.dtsi         | 22 ++++++-------
 arch/arm/dts/imx6qdl.dtsi                |  4 +--
 arch/arm/mach-imx/cpu.c                  |  2 ++
 arch/arm/mach-imx/mx6/Kconfig            |  1 +
 arch/arm/mach-imx/spl.c                  | 10 +++++-
 board/freescale/mx6sabresd/Kconfig       |  2 +-
 board/freescale/mx6sabresd/mx6sabresd.c  |  2 ++
 common/board_r.c                         | 34 ++++++++++++++++++++
 common/spl/spl.c                         | 27 ++++++++++++++--
 configs/mx6dlsabresd_optee_defconfig     | 30 ++++++++++++++++--
 drivers/core/util.c                      |  2 ++
 drivers/net/fec_mxc.c                    | 54 ++++++++++++++++++++++++++++++++
 include/configs/imx6_spl.h               |  7 +++--
 include/configs/mx6sabre_common.h        |  6 ++--
 17 files changed, 215 insertions(+), 36 deletions(-)

diff --git a/Makefile b/Makefile
index afc7904..4627c1b 100644
--- a/Makefile
+++ b/Makefile
@@ -1128,6 +1128,11 @@ u-boot-nodtb.bin: u-boot FORCE
 	$(call DO_STATIC_RELA,$<,$@,$(CONFIG_SYS_TEXT_BASE))
 	$(BOARD_SIZE_CHECK)
 
+u-boot_crc.bin: u-boot.bin
+	@dd if=/dev/zero of=u-boot_crc.bin bs=1 count=614400
+	@dd if=u-boot.bin of=u-boot_crc.bin conv=notrunc
+	@/usr/bin/crc32 ./u-boot_crc.bin > ./u-boot_crc.bin.crc
+
 u-boot.ldr:	u-boot
 		$(CREATE_LDR_ENV)
 		$(LDR) -T $(CONFIG_CPU) -c $@ $< $(LDR_FLAGS)
diff --git a/arch/arm/dts/imx6qdl-sabresd-u-boot.dtsi b/arch/arm/dts/imx6qdl-sabresd-u-boot.dtsi
index 45f02b1..e2777ff 100644
--- a/arch/arm/dts/imx6qdl-sabresd-u-boot.dtsi
+++ b/arch/arm/dts/imx6qdl-sabresd-u-boot.dtsi
@@ -5,10 +5,22 @@
 
 #include "imx6qdl-u-boot.dtsi"
 
-&usdhc3 {
+&usdhc2 {
 	u-boot,dm-spl;
 };
 
-&pinctrl_usdhc3 {
+&pinctrl_usdhc2 {
+	u-boot,dm-spl;
+};
+
+&usdhc4 {
+	u-boot,dm-spl;
+};
+
+&pinctrl_usdhc4 {
+	u-boot,dm-spl;
+};
+
+&clks {
 	u-boot,dm-spl;
 };
diff --git a/arch/arm/dts/imx6qdl-sabresd.dtsi b/arch/arm/dts/imx6qdl-sabresd.dtsi
index c252ca8..e7da680 100644
--- a/arch/arm/dts/imx6qdl-sabresd.dtsi
+++ b/arch/arm/dts/imx6qdl-sabresd.dtsi
@@ -317,10 +317,10 @@
 };
 
 &ecspi1 {
-	fsl,spi-num-chipselects = <1>;
-	cs-gpios = <&gpio4 9 0>;
+	fsl,spi-num-chipselects = <2>;
+	cs-gpios = <&gpio2 30 0 &gpio3 19 0>;
 	pinctrl-names = "default";
-	pinctrl-0 = <&pinctrl_ecspi1>;
+	pinctrl-0 = <&pinctrl_ecspi1 &pinctrl_ecspi1_cs_grp_0 &pinctrl_ecspi1_cs_grp_1>;
 	status = "okay";
 
 	flash: m25p80@0 {
@@ -675,10 +675,21 @@
 
 		pinctrl_ecspi1: ecspi1grp {
 			fsl,pins = <
-				MX6QDL_PAD_KEY_COL1__ECSPI1_MISO	0x100b1
-				MX6QDL_PAD_KEY_ROW0__ECSPI1_MOSI	0x100b1
-				MX6QDL_PAD_KEY_COL0__ECSPI1_SCLK	0x100b1
-				MX6QDL_PAD_KEY_ROW1__GPIO4_IO09		0x1b0b0
+				MX6QDL_PAD_EIM_D17__ECSPI1_MISO         0x100b1
+				MX6QDL_PAD_EIM_D18__ECSPI1_MOSI         0x100b1
+				MX6QDL_PAD_EIM_D16__ECSPI1_SCLK         0x100b1
+			>;
+		};
+
+		pinctrl_ecspi1_cs_grp_0: ecspi1_cs_grp-0 {
+			fsl,pins = <
+				0x1cc 0x59c 0x00 0x05 0x00 0x80000000
+			>;
+		};
+
+		pinctrl_ecspi1_cs_grp_1: ecspi1_cs_grp-1 {
+			fsl,pins = <
+				0x150 0x520 0x00 0x05 0x00 0x80000000
 			>;
 		};
 
@@ -1116,7 +1127,7 @@
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_usdhc2>;
 	bus-width = <8>;
-	cd-gpios = <&gpio2 2 GPIO_ACTIVE_LOW>;
+	cd-gpios = <&gpio1 4 GPIO_ACTIVE_LOW>;
 	wp-gpios = <&gpio2 3 GPIO_ACTIVE_HIGH>;
 	no-1-8-v;
 	keep-power-in-suspend;
diff --git a/arch/arm/dts/imx6qdl-u-boot.dtsi b/arch/arm/dts/imx6qdl-u-boot.dtsi
index 0aa29e3..ae8c7fe 100644
--- a/arch/arm/dts/imx6qdl-u-boot.dtsi
+++ b/arch/arm/dts/imx6qdl-u-boot.dtsi
@@ -6,17 +6,6 @@
 / {
 	soc {
 		u-boot,dm-spl;
-
-		aips-bus@2000000 {
-			u-boot,dm-spl;
-			spba-bus@2000000 {
-				u-boot,dm-spl;
-			};
-		};
-
-		aips-bus@2100000 {
-			u-boot,dm-spl;
-		};
 	};
 };
 
@@ -26,4 +15,15 @@
 
 &iomuxc {
 	u-boot,dm-spl;
+	imx6qdl-sabresd {
+		u-boot,dm-spl;
+	};
+};
+
+&aips1 {
+        u-boot,dm-spl;
+};
+
+&aips2 {
+        u-boot,dm-spl;
 };
diff --git a/arch/arm/dts/imx6qdl.dtsi b/arch/arm/dts/imx6qdl.dtsi
index e7774b8..51a3c6d 100644
--- a/arch/arm/dts/imx6qdl.dtsi
+++ b/arch/arm/dts/imx6qdl.dtsi
@@ -33,10 +33,10 @@
 		i2c1 = &i2c2;
 		i2c2 = &i2c3;
 		ipu0 = &ipu1;
-		mmc0 = &usdhc1;
+		mmc0 = &usdhc4;
 		mmc1 = &usdhc2;
 		mmc2 = &usdhc3;
-		mmc3 = &usdhc4;
+		mmc3 = &usdhc1;
 		serial0 = &uart1;
 		serial1 = &uart2;
 		serial2 = &uart3;
diff --git a/arch/arm/mach-imx/cpu.c b/arch/arm/mach-imx/cpu.c
index c7026d8..b0b18cf 100644
--- a/arch/arm/mach-imx/cpu.c
+++ b/arch/arm/mach-imx/cpu.c
@@ -379,8 +379,10 @@ void arch_preboot_os(void)
 #endif
 #endif
 #if defined(CONFIG_LDO_BYPASS_CHECK)
+#if defined(CONFIG_POWER) || defined(CONFIG_DM_PMIC_PFUZE100)
 	ldo_mode_set(check_ldo_bypass());
 #endif
+#endif
 #if defined(CONFIG_VIDEO_IPUV3)
 	/* disable video before launching O/S */
 	ipuv3_fb_shutdown();
diff --git a/arch/arm/mach-imx/mx6/Kconfig b/arch/arm/mach-imx/mx6/Kconfig
index 88f188e..0ea8628 100644
--- a/arch/arm/mach-imx/mx6/Kconfig
+++ b/arch/arm/mach-imx/mx6/Kconfig
@@ -401,6 +401,7 @@ config TARGET_MX6DLSABRESD
 	bool "mx6dlsabresd"
     select TARGET_MX6SABRESD_COMMON
     select MX6DL
+    select SUPPORT_SPL
 
 config TARGET_MX6SOLOSABRESD
 	bool "mx6solosabresd"
diff --git a/arch/arm/mach-imx/spl.c b/arch/arm/mach-imx/spl.c
index 6a30e93..0ed1010 100644
--- a/arch/arm/mach-imx/spl.c
+++ b/arch/arm/mach-imx/spl.c
@@ -193,10 +193,11 @@ int g_dnl_get_board_bcd_device_number(int gcnum)
 }
 #endif
 
-#if defined(CONFIG_SPL_MMC_SUPPORT)
+#ifndef CONFIG_SPL_MMC_SUPPORT
 /* called from spl_mmc to see type of boot mode for storage (RAW or FAT) */
 u32 spl_boot_mode(const u32 boot_device)
 {
+#if defined(CONFIG_SPL_BUILD)
 #if defined(CONFIG_MX7) || defined(CONFIG_IMX8M) || defined(CONFIG_IMX8)
 	switch (get_boot_device()) {
 	/* for MMC return either RAW or FAT mode */
@@ -244,6 +245,13 @@ u32 spl_boot_mode(const u32 boot_device)
 		hang();
 	}
 #endif
+#else /* CONFIG_SPL_BUILD */
+#if defined(CONFIG_SPL_FS_FAT) || defined(CONFIG_SPL_FS_EXT4)
+	return MMCSD_MODE_FS;
+#else
+	return MMCSD_MODE_RAW;
+#endif
+#endif /* CONFIG_SPL_BUILD */
 }
 #endif
 
diff --git a/board/freescale/mx6sabresd/Kconfig b/board/freescale/mx6sabresd/Kconfig
index 124ba8b..9ea6714 100644
--- a/board/freescale/mx6sabresd/Kconfig
+++ b/board/freescale/mx6sabresd/Kconfig
@@ -10,6 +10,6 @@ config SYS_CONFIG_NAME
 	default "mx6sabresd"
 
 config SYS_TEXT_BASE
-    default 0x17800000
+    default 0x26800000
 
 endif
diff --git a/board/freescale/mx6sabresd/mx6sabresd.c b/board/freescale/mx6sabresd/mx6sabresd.c
index 282930c..38586d6 100644
--- a/board/freescale/mx6sabresd/mx6sabresd.c
+++ b/board/freescale/mx6sabresd/mx6sabresd.c
@@ -1634,8 +1634,10 @@ static void spl_dram_init(void)
 
 void board_init_f(ulong dummy)
 {
+#ifndef CONFIG_SPL_BUILD
 	/* DDR initialization */
 	spl_dram_init();
+#endif
 
 	/* setup AIPS and disable watchdog */
 	arch_cpu_init();
diff --git a/common/board_r.c b/common/board_r.c
index e0af4c5..f35ac50 100644
--- a/common/board_r.c
+++ b/common/board_r.c
@@ -664,6 +664,39 @@ static int initr_check_spl_recovery(void)
 }
 #endif
 
+static int board_set_boot_device(void){
+	char buf[256];
+	char advboot_version[128];
+	int dev = (*(int *)0x22200000);
+	/* log uboot version */
+	strncpy(advboot_version, (void *)0x22300000, 128);
+	if ((strstr(advboot_version,"advantech") == NULL) && (strstr(advboot_version,"LIV") == NULL))
+		strcpy(advboot_version, "");
+	switch(dev){
+		case 1:
+		default: 
+			printf("\033[1;33m"); 
+			printf("booting from SD Card...\n");
+			printf("\033[0m"); 
+			env_set("tee", "no");
+			env_set("mmcdev", "1");
+			sprintf(buf, "/dev/mmcblk1p2 rootwait rw");
+			env_set("mmcroot", buf);
+			break; 
+		case 3:
+			/* booting from iNAND*/
+			printf("\033[1;33m"); 
+			printf("booting from iNAND...\n");
+			printf("\033[0m"); 
+			env_set("tee", "no");
+			env_set("mmcdev", "0");
+			sprintf(buf, "/dev/mmcblk0p2 rootwait rw");
+			env_set("mmcroot", buf);
+			break;
+	}
+	return 0; 
+}
+
 static int run_main_loop(void)
 {
 #ifdef CONFIG_SANDBOX
@@ -831,6 +864,7 @@ static init_fnc_t init_sequence_r[] = {
 #ifdef CONFIG_BOARD_LATE_INIT
 	board_late_init,
 #endif
+	board_set_boot_device, 
 #ifdef CONFIG_FSL_FASTBOOT
 	initr_fastboot_setup,
 #endif
diff --git a/common/spl/spl.c b/common/spl/spl.c
index 88d4b8a..26d1326 100644
--- a/common/spl/spl.c
+++ b/common/spl/spl.c
@@ -566,8 +566,8 @@ static int boot_from_devices(struct spl_image_info *spl_image,
 void board_init_r(gd_t *dummy1, ulong dummy2)
 {
 	u32 spl_boot_list[] = {
-		BOOT_DEVICE_NONE,
-		BOOT_DEVICE_NONE,
+		BOOT_DEVICE_MMC1, /* SD Card*/
+		BOOT_DEVICE_MMC2, /* eMMC */
 		BOOT_DEVICE_NONE,
 		BOOT_DEVICE_NONE,
 		BOOT_DEVICE_NONE,
@@ -610,7 +610,9 @@ void board_init_r(gd_t *dummy1, ulong dummy2)
 	spl_image.arg = (void *)CONFIG_SYS_SPL_ARGS_ADDR;
 #endif
 	spl_image.boot_device = BOOT_DEVICE_NONE;
+#if 0
 	board_boot_order(spl_boot_list);
+#endif
 
 	if (boot_from_devices(&spl_image, spl_boot_list,
 			      ARRAY_SIZE(spl_boot_list))) {
@@ -676,6 +678,27 @@ void board_init_r(gd_t *dummy1, ulong dummy2)
 
 	debug("loaded - jumping to U-Boot...\n");
 	spl_board_prepare_for_boot();
+
+	memset((void *)0x22300000, 0, 128);
+        strcpy((void *)0x22300000, "advantech");
+        
+        /* forword memory size to uboot */
+        *(unsigned int *)0x22400000 = PHYS_SDRAM_SIZE;
+        
+        /* record ddr bit, 32 or 64 bit */
+#ifdef CONFIG_DDR_32BIT 
+        *(unsigned int *)0x22500000 = 32;
+#else   
+        *(unsigned int *)0x22500000 = 64;
+#endif
+	switch(spl_image.boot_device){
+		case BOOT_DEVICE_MMC1: /* SD CArd */ 
+			*(int *)0x22200000 = 0x01;
+			break; 
+		case BOOT_DEVICE_MMC2: /* eMMC */
+			*(int *)0x22200000 = 0x03;
+			break; 
+	}
 	jump_to_image_no_args(&spl_image);
 }
 
diff --git a/configs/mx6dlsabresd_optee_defconfig b/configs/mx6dlsabresd_optee_defconfig
index cb167ba..3f29beb 100644
--- a/configs/mx6dlsabresd_optee_defconfig
+++ b/configs/mx6dlsabresd_optee_defconfig
@@ -5,7 +5,7 @@ CONFIG_NR_DRAM_BANKS=1
 CONFIG_VIDEO=y
 CONFIG_SYS_EXTRA_OPTIONS="IMX_CONFIG=board/freescale/mx6sabresd/mx6dlsabresd.cfg"
 CONFIG_IMX_OPTEE=y
-CONFIG_ENV_IS_IN_MMC=y
+CONFIG_ENV_IS_IN_SPI_FLASH=y
 CONFIG_BOOTDELAY=3
 # CONFIG_CONSOLE_MUX is not set
 CONFIG_SYS_CONSOLE_IS_IN_ENV=y
@@ -41,6 +41,7 @@ CONFIG_SF_DEFAULT_MODE=0
 CONFIG_SF_DEFAULT_SPEED=20000000
 CONFIG_SF_DEFAULT_CS=0
 CONFIG_SPI_FLASH_STMICRO=y
+CONFIG_SPI_FLASH_WINBOND=y
 CONFIG_SPI=y
 CONFIG_DM_SPI=y
 CONFIG_MXC_SPI=y
@@ -67,9 +68,7 @@ CONFIG_FSL_ESDHC=y
 CONFIG_PINCTRL=y
 CONFIG_PINCTRL_IMX6=y
 CONFIG_DM_PMIC=y
-CONFIG_DM_PMIC_PFUZE100=y
 CONFIG_DM_REGULATOR=y
-CONFIG_DM_REGULATOR_PFUZE100=y
 CONFIG_DM_REGULATOR_FIXED=y
 CONFIG_DM_REGULATOR_GPIO=y
 CONFIG_DM_ETH=y
@@ -88,3 +87,28 @@ CONFIG_FASTBOOT_BUF_ADDR=0x12C00000
 CONFIG_FASTBOOT_BUF_SIZE=0x40000000
 CONFIG_FASTBOOT_FLASH=y
 CONFIG_EFI_PARTITION=y
+
+CONFIG_SPL=y
+CONFIG_SPL_DM=y
+CONFIG_SPL_GPIO_SUPPORT=y
+CONFIG_SPL_LIBCOMMON_SUPPORT=y
+CONFIG_SPL_LIBGENERIC_SUPPORT=y
+CONFIG_SPL_MMC_SUPPORT=y
+CONFIG_SPL_SERIAL_SUPPORT=y
+CONFIG_SPL_LIBDISK_SUPPORT=y
+CONFIG_SPL_SPI_FLASH_SUPPORT=y
+CONFIG_SPL_SPI_SUPPORT=y
+CONFIG_SPL_FS_FAT=y
+CONFIG_SPL_I2C_SUPPORT=y
+CONFIG_SPL_SPI_FLASH_TINY=y
+CONFIG_SPL_WATCHDOG_SUPPORT=y
+#CONFIG_SPL_SPI_LOAD=y
+CONFIG_SPL_OF_CONTROL=y
+CONFIG_SPL_PINCTRL=y
+CONFIG_SPL_RAW_IMAGE_SUPPORT=y
+CONFIG_SPL_STACK_R_ADDR=0x18000000
+CONFIG_SPL_STACK_R=y
+# CONFIG_OF_EMBED=y
+CONFIG_OF_SPL_REMOVE_PROPS=""
+CONFIG_SPL_SEPARATE_BSS=y
+CONFIG_SYS_MMCSD_RAW_MODE_U_BOOT_SECTOR=0x3
diff --git a/drivers/core/util.c b/drivers/core/util.c
index 27a6848..07e3dd5 100644
--- a/drivers/core/util.c
+++ b/drivers/core/util.c
@@ -67,6 +67,7 @@ bool dm_ofnode_pre_reloc(ofnode node)
 	if (ofnode_read_bool(node, "u-boot,dm-spl"))
 		return true;
 #else
+#if 0
 	/*
 	 * In regular builds individual spl and tpl handling both
 	 * count as handled pre-relocation for later second init.
@@ -75,6 +76,7 @@ bool dm_ofnode_pre_reloc(ofnode node)
 	    ofnode_read_bool(node, "u-boot,dm-tpl"))
 		return true;
 #endif
+#endif
 
 	return false;
 }
diff --git a/drivers/net/fec_mxc.c b/drivers/net/fec_mxc.c
index f87ae1e..34c93c9 100644
--- a/drivers/net/fec_mxc.c
+++ b/drivers/net/fec_mxc.c
@@ -388,9 +388,63 @@ static void fec_rbd_clean(int last, struct fec_bd *prbd)
 	writew(0, &prbd->data_length);
 }
 
+#include <version.h>
+#include <spi_flash.h>
+struct boardcfg_t {
+    unsigned char mac[6];
+    unsigned char sn[10];
+    unsigned char Manufacturing_Time[14];
+};
+static struct spi_flash *flash;
 static int fec_get_hwaddr(int dev_id, unsigned char *mac)
 {
+#if 0
 	imx_get_mac_from_fuse(dev_id, mac);
+#else
+	struct boardcfg_t boardcfg;
+	uint64_t macaddr = 0;
+	char print_buf[32];
+	flash = spi_flash_probe(CONFIG_SF_DEFAULT_BUS, CONFIG_SF_DEFAULT_CS, 
+			CONFIG_SF_DEFAULT_SPEED, CONFIG_SF_DEFAULT_MODE);
+	if (flash){
+		if(spi_flash_read(flash, CONFIG_ENV_OFFSET+8*CONFIG_ENV_SIZE, 
+					sizeof(boardcfg), &boardcfg)==0) {
+			macaddr = ((uint64_t)boardcfg.mac[0] << 40)
+				+ ((uint64_t)boardcfg.mac[1] << 32)
+				+ ((uint64_t)boardcfg.mac[2] << 24)
+				+ ((uint64_t)boardcfg.mac[3] << 16)
+				+ ((uint64_t)boardcfg.mac[4] << 8)
+				+ boardcfg.mac[5];
+			if( (macaddr==0) || (macaddr==0xFFFFFFFFFFFFull) ) {
+				mac[0]='\x00';
+				mac[1]='\x04';
+				mac[2]='\x9F';
+				mac[3]='\x01';
+				mac[4]='\x30';
+				mac[5]='\xE0';
+				printf("** No SPI FLASH MAC: Use default MAC address!! **\n");
+			}else{
+				for(int i=0; i<6; i++){
+					mac[i]=boardcfg.mac[i]; 
+				}
+			}
+			sprintf(print_buf, "0x%02X:0x%02X:0x%02X:0x%02X:0x%02X:0x%02X", 
+					mac[0],	mac[1],	mac[2],	mac[3],	mac[4],	mac[5]);
+			env_set("ethaddr", print_buf);
+		}
+	}else{
+		printf("** SPI FLASH Error: Use default MAC address!! **\n");
+		mac[0]='\x00';
+		mac[1]='\x04';
+		mac[2]='\x9F';
+		mac[3]='\x01';
+		mac[4]='\x30';
+		mac[5]='\xE0';
+		sprintf(print_buf, "0x%02X:0x%02X:0x%02X:0x%02X:0x%02X:0x%02X", 
+				mac[0],	mac[1],	mac[2],	mac[3],	mac[4],	mac[5]);
+		env_set("ethaddr",print_buf);
+	}
+#endif
 	return !is_valid_ethaddr(mac);
 }
 
diff --git a/include/configs/imx6_spl.h b/include/configs/imx6_spl.h
index 3d9a7dc..4e85f1f 100644
--- a/include/configs/imx6_spl.h
+++ b/include/configs/imx6_spl.h
@@ -33,7 +33,8 @@
 /* MMC support */
 #if defined(CONFIG_SPL_MMC_SUPPORT)
 #define CONFIG_SYS_MMCSD_FS_BOOT_PARTITION	1
-#define CONFIG_SYS_MONITOR_LEN			409600	/* 400 KB */
+#define CONFIG_SYS_U_BOOT_MAX_SIZE_SECTORS      0x4B0 /* 600 KB */
+#define CONFIG_SYS_MONITOR_LEN                  (600 * 1024) /* Reserve 600 kB for Monitor */
 #endif
 
 /* SATA support */
@@ -59,9 +60,9 @@
 #define CONFIG_SYS_SPL_MALLOC_SIZE     0x100000		/* 1 MB */
 #else
 #define CONFIG_SPL_BSS_START_ADDR	0x18200000
-#define CONFIG_SPL_BSS_MAX_SIZE		0x100000	/* 1 MB */
+#define CONFIG_SPL_BSS_MAX_SIZE		0x1000000	/* 16 MB */
 #define CONFIG_SYS_SPL_MALLOC_START	0x18300000
-#define CONFIG_SYS_SPL_MALLOC_SIZE	0x100000	/* 1 MB */
+#define CONFIG_SYS_SPL_MALLOC_SIZE	0x3200000	/* 50 MB */
 #endif
 #endif
 
diff --git a/include/configs/mx6sabre_common.h b/include/configs/mx6sabre_common.h
index 50aae8e..e7b56b0 100644
--- a/include/configs/mx6sabre_common.h
+++ b/include/configs/mx6sabre_common.h
@@ -30,9 +30,9 @@
 #else
 #define CONFIG_ETHPRIME			"FEC"
 #endif
-#define CONFIG_FEC_MXC_PHYADDR		1
+#define CONFIG_FEC_MXC_PHYADDR		7
 
-#define CONFIG_PHY_ATHEROS
+#define CONFIG_PHY_REALTEK
 
 #ifdef CONFIG_MX6S
 #define SYS_NOSMP "nosmp"
@@ -371,7 +371,7 @@
 #if defined(CONFIG_ENV_IS_IN_MMC)
 #define CONFIG_ENV_OFFSET		(896 * 1024)
 #elif defined(CONFIG_ENV_IS_IN_SPI_FLASH)
-#define CONFIG_ENV_OFFSET              (896 * 1024)
+#define CONFIG_ENV_OFFSET              (768 * 1024)
 #define CONFIG_ENV_SECT_SIZE           (64 * 1024)
 #define CONFIG_ENV_SPI_BUS             CONFIG_SF_DEFAULT_BUS
 #define CONFIG_ENV_SPI_CS              CONFIG_SF_DEFAULT_CS
